# UI 추가 표시 항목 계획 (2026-02-28)

> 현재 대시보드에서 사용자에게 더 보여줄 수 있는 항목을 검토하고 정리한 문서.
> 기존 데이터 활용도, 구현 난이도, 사용자 가치를 기준으로 우선순위를 분류한다.

## 변경 이력
| 날짜 | 내용 |
|------|------|
| 2026-02-28 | 초안 작성 |
| 2026-02-28 | 검토 반영: 라인 넘버 수정, recent 슬라이스 크기 정정(300), Node token 미지원 명시, 1-5 알림 배지 "미확인" 표현 제거, Tier 분류 근거 재검증 |

---

## 현재 대시보드 표시 현황

| 섹션 | 표시 항목 | 파일 위치 |
|------|----------|-----------|
| 지표 카드 (6개) | Agents, Total Events, Total Tokens, OK, Warning, Error | `app.js:62-78` |
| 처리량 차트 | 분당 이벤트 수 바 차트 (30분) | `app.js:233-291` |
| 토큰 추이 차트 | 에이전트별 분당 토큰 사용량 라인 차트 (30분) | `app.js:304-390` |
| Workflow 진행 | lead/designer/frontend/backend 역할별 상태 (idle/running/at-risk/blocked) | `app.js:85-98` |
| Local Codex Feed | 소스별 통계 (total, ok/warn/error, lastSeen) | `app.js:100-118` |
| Agent 상태 테이블 | agentId, lastSeen, total, ok, warn, error, tokens, lastEvent, latency | `app.js:120-143` |
| 최근 이벤트 | 시간, agentId, event, message, status (필터/검색/행수 제어) | `app.js:149-185` |
| Alerts | warning/error 이벤트만 표시 | `app.js:187-206` |
| 연결 상태 | 헤더 배지 (connected/reconnecting/offline) | `app.js:35-38` |

---

## Tier 1 — 프론트엔드만 수정 (백엔드 데이터 이미 존재)

### 1-1. 에이전트별 성공률 (%) 컬럼 추가

| 항목 | 내용 |
|------|------|
| 설명 | Agent 테이블에 `ok / total * 100`으로 계산한 성공률 컬럼 추가 |
| 근거 | `ok`, `total` 필드가 이미 에이전트별로 존재하지만 비율로 보여주지 않음 |
| 수정 파일 | `public/index.html` (th 추가), `public/app.js:renderAgents` |
| 구현량 | ~10줄 |
| 사용자 가치 | 높음 — 한눈에 에이전트 건강도 파악 가능 |

### 1-2. 이벤트 상세 펼치기 (클릭 확장)

| 항목 | 내용 |
|------|------|
| 설명 | 이벤트 행 클릭 시 `metadata` 객체 전체를 JSON 형태로 펼쳐 보여줌 |
| 근거 | `metadata`에 `tokenUsage`, `source`, 기타 컨텍스트가 포함되어 있으나 현재 미표시 |
| 수정 파일 | `public/app.js:renderEvents`, `public/styles.css` |
| 구현량 | ~30줄 (JS 이벤트 핸들러 + CSS 토글) |
| 사용자 가치 | 높음 — 디버깅 시 상세 정보 접근 가능 |

### 1-3. 에이전트별 토큰 비교 바 차트

| 항목 | 내용 |
|------|------|
| 설명 | 에이전트별 누적 토큰 사용량을 수평 바 차트로 비교 |
| 근거 | Rust `AgentRow.token_total` → JSON `agents[].tokenTotal`이 존재. 테이블 셀(`app.js:136`)과 시계열 차트에서 활용되나, 에이전트 간 비교 전용 뷰는 없음 |
| 수정 파일 | `public/index.html` (섹션 추가), `public/app.js` (렌더 함수 추가) |
| 구현량 | ~50줄 |
| 사용자 가치 | 중간 — 리소스 소비 에이전트 즉시 식별 |

### 1-4. 에이전트 활성도 표시 (마지막 활동 경과 시간)

| 항목 | 내용 |
|------|------|
| 설명 | Agent 테이블의 `Last Seen`을 "3분 전" 같은 상대 시간으로 표시하고, 5분 이상 미활동 시 비활성 스타일 적용 |
| 근거 | `lastSeen` 타임스탬프가 존재하나 절대 시간으로만 표시됨 |
| 수정 파일 | `public/app.js:renderAgents`, `public/styles.css` |
| 구현량 | ~20줄 |
| 사용자 가치 | 중간 — 에이전트 가동 상태를 직관적으로 파악 |

### 1-5. 알림 카운트 배지 (헤더)

| 항목 | 내용 |
|------|------|
| 설명 | 헤더 영역에 현재 warning/error 총 개수를 배지로 표시 |
| 근거 | 알림이 페이지 하단에만 있어 스크롤 없이 인지 불가. 현재 "미확인" 추적 기능은 없으므로 `totals.warning + totals.error` 합산 표시 |
| 수정 파일 | `public/index.html` (배지 요소), `public/app.js:renderSnapshot`, `public/styles.css` |
| 구현량 | ~15줄 |
| 사용자 가치 | 높음 — 페이지 상단에서 즉시 위험 인지 |

---

## Tier 2 — 프론트엔드 중규모 변경

### 2-1. 시간 범위 필터

| 항목 | 내용 |
|------|------|
| 설명 | 최근 5분 / 15분 / 30분 / 1시간 선택으로 이벤트·차트 범위 제한 |
| 근거 | 현재 차트는 30분 고정, 이벤트는 최신 N건만 표시 |
| 수정 파일 | `public/index.html` (select 추가), `public/app.js` (필터 로직 + `buildMinuteBuckets` 파라미터화) |
| 구현량 | ~40줄 |
| 사용자 가치 | 높음 — 특정 구간 집중 분석 가능 |

### 2-2. 에러율 스파크라인 (Agent 테이블 인라인)

| 항목 | 내용 |
|------|------|
| 설명 | 각 에이전트 행에 최근 30분간 에러 발생 추세를 인라인 미니 SVG로 표시 |
| 근거 | 에러 수치만으로는 추세 파악이 어려움 |
| 수정 파일 | `public/app.js:renderAgents`, `public/styles.css` |
| 구현량 | ~60줄 |
| 전제 조건 | 이벤트 데이터에서 에이전트별 시간 버킷 분리 필요 (프론트 계산) |
| 사용자 가치 | 중간 — 에러 급증 패턴을 시각적으로 감지 |

### 2-3. 다크 모드 토글

| 항목 | 내용 |
|------|------|
| 설명 | 헤더에 라이트/다크 토글 버튼 추가. CSS 변수 기반으로 전환 |
| 근거 | 현재 warm 팔레트(#F6EDE3 배경)만 존재 |
| 수정 파일 | `public/styles.css` (`:root[data-theme="dark"]` 변수 셋), `public/app.js` (토글 + localStorage 저장), `public/index.html` |
| 구현량 | ~60줄 (CSS) + ~15줄 (JS) |
| 사용자 가치 | 중간 — 야간/저조도 환경 사용성 개선 |

### 2-4. 브라우저 알림 (Notification API)

| 항목 | 내용 |
|------|------|
| 설명 | error 이벤트 수신 시 `Notification.requestPermission()` 기반 데스크톱 알림 발송 |
| 근거 | 대시보드를 안 보고 있을 때 중요 에러를 놓칠 수 있음 |
| 수정 파일 | `public/app.js:applyIncrementalEvent` |
| 구현량 | ~20줄 |
| 사용자 가치 | 높음 — 백그라운드에서도 즉시 인지 가능 |

---

## Tier 3 — 백엔드 수정 필요

### 3-1. Latency 퍼센타일 집계 (p50/p95/p99)

| 항목 | 내용 |
|------|------|
| 설명 | 에이전트별 latency 값을 누적 저장하여 p50, p95, p99 퍼센타일 제공 |
| 근거 | 현재 마지막 latency 값만 덮어쓰기 (`AgentRow.latency_ms`, `src/main.rs:287`). 누적 분포 파악 불가 |
| 수정 파일 | `src/main.rs` (AgentRow에 latency 벡터 추가 + 퍼센타일 계산), `public/app.js` (표시) |
| 구현량 | Rust ~40줄, JS ~20줄 |
| 사용자 가치 | 높음 — 성능 모니터링의 핵심 지표 |

### 3-2. 서버 측 시간 버킷 집계 API

| 항목 | 내용 |
|------|------|
| 설명 | `GET /api/timeseries?minutes=60&bucket=5` — 서버에서 시간 버킷 집계를 제공 |
| 근거 | 현재 프론트에서 서버가 보내는 최근 300건(`take(300)`)의 raw 이벤트를 받아 직접 버킷 계산. 인메모리 보관은 200건(`truncate(200)`)이므로 실제 차트 데이터는 최대 200건 기반. 장시간 운영 시 부정확 |
| 수정 파일 | `src/main.rs` (새 엔드포인트 + 버킷 자료구조), `public/app.js` (차트 데이터 소스 변경) |
| 구현량 | Rust ~80줄, JS ~30줄 |
| 사용자 가치 | 중간 — 장시간 운영 시 차트 정확도 향상 |

### 3-3. 이벤트 내보내기 (CSV/JSON)

| 항목 | 내용 |
|------|------|
| 설명 | `GET /api/events/export?format=csv` 엔드포인트 + UI에 다운로드 버튼 |
| 근거 | 이벤트 데이터를 외부 분석 도구로 가져갈 방법이 없음 |
| 수정 파일 | `src/main.rs` (엔드포인트), `public/index.html` (버튼), `public/app.js` (다운로드 트리거) |
| 구현량 | Rust ~50줄, JS ~15줄 |
| 사용자 가치 | 중간 — 데이터 분석·리포팅 용도 |

### 3-4. 데이터 영속화 (SQLite)

| 항목 | 내용 |
|------|------|
| 설명 | 서버 재시작 시 데이터 유실 방지를 위한 SQLite 저장 |
| 근거 | 현재 모든 상태가 인메모리. 서버 재시작 시 전체 초기화 |
| 수정 파일 | `src/main.rs` (전면 리팩터링), `Cargo.toml` (rusqlite 의존성) |
| 구현량 | ~200줄+ |
| 사용자 가치 | 높음 — 히스토리 보존, 장기 트렌드 분석 가능 |
| 비고 | 마이그레이션 Phase 3-3에 이미 계획됨 (`improvement-plan-2026-02-26.md:439`). `rusqlite` 기반 로컬 DB 방향 확정 |

### 3-5. Rate Limiting

| 항목 | 내용 |
|------|------|
| 설명 | `POST /api/events`에 IP/키 기반 요청 제한 |
| 근거 | 현재 제한 없이 무한 이벤트 수집 가능. 메모리 고갈 위험 |
| 수정 파일 | `src/main.rs` (미들웨어 또는 핸들러 앞단) |
| 구현량 | ~40줄 |
| 사용자 가치 | 낮음 (로컬 전용) — 공개 배포 시 필수 |

---

## 권장 구현 순서

> 사용자 가치 대비 구현 비용이 낮은 순서로 정렬

| 순번 | 항목 | Tier | 예상 변경량 | 핵심 이유 |
|------|------|------|------------|-----------|
| 1 | 에이전트별 성공률 % | T1 | ~10줄 | 한 컬럼 추가로 건강도 즉시 파악 |
| 2 | 알림 카운트 배지 | T1 | ~15줄 | 스크롤 없이 위험 인지 |
| 3 | 이벤트 상세 펼치기 | T1 | ~30줄 | metadata 활용도 극대화 |
| 4 | 에이전트 활성도 표시 | T1 | ~20줄 | 가동 상태 직관적 파악 |
| 5 | 브라우저 알림 | T2 | ~20줄 | 백그라운드 에러 인지 |
| 6 | 시간 범위 필터 | T2 | ~40줄 | 구간 분석 가능 |
| 7 | 토큰 비교 바 차트 | T1 | ~50줄 | 리소스 소비 비교 |
| 8 | Latency 퍼센타일 | T3 | ~60줄 | 성능 모니터링 핵심 |
| 9 | 다크 모드 | T2 | ~75줄 | 야간 사용성 |
| 10 | 이벤트 내보내기 | T3 | ~65줄 | 외부 분석 연동 |
| 11 | 에러율 스파크라인 | T2 | ~60줄 | 추세 시각화 |
| 12 | 서버 시간 버킷 API | T3 | ~110줄 | 차트 정확도 |
| 13 | 데이터 영속화 | T3 | ~200줄+ | 히스토리 보존 (Phase 3 연계) |

---

## 관련 문서

- 마이그레이션 총괄: [role-plan.md](./role-plan.md)
- 진행 현황: [progress.md](./progress.md)
- 기존 개선 계획: [improvement-plan-2026-02-26.md](./improvement-plan-2026-02-26.md)
- 디자인 토큰: [tokens.md](./tokens.md)
